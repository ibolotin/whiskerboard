{% extends "base.html" %}
{% load staticfiles %}
{% block content %}
{% regroup services|dictsort:"category.name" by category as category_list %}
<div id="webservices" class="">
  {% for category in category_list %}
  <h2 class="category"><!-- {{ category.grouper.name }}--></h2>
  <div class="category-desc">
    <!--{{ category.grouper.description|safe }} -->
  </div>
  <table style="font-size: 30px; width:100%; margin-left:auto; margin-right:auto;" id="service-list" class="table">
    <thead>
      <tr>
        <th>Service</th>
        <th>State</th>
      </tr>
    </thead>
    <tbody id="services-body">
    {% for service in category.list %}
    <tr>
      <td><a href="{{ service.get_absolute_url }}">{{ service.name }}</a>&nbsp;<span class='circlequestion' title='{{ service.long_description }}'></span></td>
      <td class="status highlight">
        {% with service.events.latest.status as latest_status %}
        {% if latest_status %}
        <font color="{{ latest_status.color }}">{{ latest_status.description }}</font>
        <!-- <img src="{% static 'images/status/' %}{{ latest_status.image }}.png" alt="{{ latest_status }} "/> -->
        {% else %}
        <font color="{{ default.color }}">{{ default.description }}</font>
        <!-- <img src="{% static 'images/status/' %}{{ default.image }}.png" alt="{{ default.name }} "/> -->
        {% endif %}
        {% endwith %}
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
  {% endfor %}
  <br>
  <div id='past-events'>
    <h2>Past Events</h2>
    {% regroup events by service as events_list %}
    {% for service in events_list %}
    <h4>{{ service.grouper }}</h4>
    {% regroup service.list by start|date:"N j" as service_events_list %}
    {% for service_event in service_events_list %}
    <h5>{{ service_event.grouper }}</h5>
    <ul style="list-style: none">
      {% for item_event in service_event.list %}
      <li>{{ item_event.start|date:"fA" }} {{ item_event.message|safe }}</li>
      {% endfor %}
    </ul>
    {% endfor %}
    {% empty %}
    <p>No events found</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
