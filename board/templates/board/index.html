{% extends "base.html" %}
{% load staticfiles %}
{% block content %}
{% regroup services|dictsort:"category.name" by category as category_list %}
<div id="webservices" class="">
    {% for category in category_list %}
    <h2 class="category"><!-- {{ category.grouper.name }}--></h2>
    <div class="category-desc">
        <!--{{ category.grouper.description|safe }} -->
    </div>
    <table id="services-table" class="table">
        <thead>
            <tr>
                <th>Service</th>
                <th>State</th>
            </tr>
        </thead>
        <tbody id="services-body">
        {% for service in category.list %}
        <tr>
            <td>{{ service.name }}</td>
            {% with service.events.latest.status as latest_status %}
            {% if latest_status %}
            <td class="status bg-danger">
                {{ latest_status.description }}
            </td>
            {% else %}
            <td class="status">
                {{ default.description }}
            </td>
            {% endif %}
            {% endwith %}
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% endfor %}
</div>
<br>
<div id='event-log'>
    <h2>Recent Events</h2>
    {% for day, incidents in dates.items %}
    {% if incidents|length == 0 %}
    <div class="null event">{{ day|date:"M j, Y" }}: No incidents reported.</div>
    {% else %}
    {% for incident in incidents %}
    <div class="danger event">
        {{ day|date:"M j, Y" }}:
            <h6>{{ incident.name }}</h6>
            <a href="/incidents/{{ incident.slug }}"><h3>Services: {{ incident.services }}</h3></a>
            {% for item_event in incident.events.all %}
                <p>{{ item_event.message|safe }}</p>
                <p>{{ item_event.start|date:"M j, H:i T" }}</p>
            {% endfor %}
    </div>
    {% endfor %}
    {% endif %}
    {% endfor %}
</div>
{% endblock %}
